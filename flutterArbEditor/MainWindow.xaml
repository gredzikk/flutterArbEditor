<Window
    x:Class="flutterArbEditor.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:flutterArbEditor"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Flutter ARB Editor"
    Width="1400"
    Height="900"
    AllowDrop="True"
    Drop="Window_Drop"
    FontFamily="Segoe UI"
    mc:Ignorable="d">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Toolbar  -->
        <ToolBar Grid.Row="0" Margin="0,0,0,12">
            <Button
                Command="{Binding AddFilesCommand}"
                Content="🗂️ Add Files"
                Style="{StaticResource PrimaryButton}" />
            <Button
                Margin="8,0"
                Command="{Binding SaveAllCommand}"
                Content="💾 Save All"
                Style="{StaticResource SuccessButton}" />
            <Separator />
            <CheckBox
                Margin="12,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Content="Sort keys on save"
                IsChecked="{Binding SortKeysOnSave}" />
            <Separator />
            <Button
                Command="{Binding RunFlutterGenCommand}"
                Content="🚀 Flutter gen-l10n"
                Style="{StaticResource AccentButton}" />
        </ToolBar>

        <!--  Main Content  -->
        <Grid Grid.Row="1" Margin="0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="320" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--  Files List  -->
            <GroupBox
                Grid.Column="0"
                Header="📁 ARB Files"
                Style="{StaticResource CardGroupBox}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <ListView
                        Grid.Row="0"
                        ItemsSource="{Binding ArbFiles}"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        SelectedItem="{Binding SelectedFile}">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="4">
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontSize="14"
                                        FontWeight="SemiBold"
                                        Text="{Binding FileName}" />
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock VerticalAlignment="Center" Text="🌐 Language: " />
                                        <TextBox
                                            MinWidth="60"
                                            Margin="4,0"
                                            Text="{Binding LanguageCode, UpdateSourceTrigger=PropertyChanged}" />
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <StackPanel
                        Grid.Row="1"
                        Margin="0,12,0,0"
                        Orientation="Horizontal">
                        <Button
                            Margin="0,0,8,0"
                            Command="{Binding AddFilesCommand}"
                            Content="➕ Add"
                            Style="{StaticResource PrimaryButton}" />
                        <Button
                            Command="{Binding RemoveFileCommand}"
                            CommandParameter="{Binding SelectedFile}"
                            Content="🗑️ Remove"
                            Style="{StaticResource DangerButton}" />
                    </StackPanel>
                </Grid>
            </GroupBox>

            <GridSplitter Grid.Column="1" />

            <!--  Translation Keys  -->
            <GroupBox
                Grid.Column="2"
                Header="🔑 Translation Keys"
                Style="{StaticResource CardGroupBox}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!--  Add New Key Section  -->
                    <Border
                        Grid.Row="0"
                        Margin="0,0,0,12"
                        Padding="12"
                        Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                        <StackPanel>
                            <TextBlock
                                Margin="0,0,0,8"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Text="✨ Add New Key:" />
                            <TextBox Margin="0,0,0,8" Text="{Binding NewKeyName, UpdateSourceTrigger=PropertyChanged}" />
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    Margin="0,0,8,0"
                                    Command="{Binding AddNewKeyCommand}"
                                    Content="➕ Add Key"
                                    Style="{StaticResource SuccessButton}" />
                                <Button
                                    Command="{Binding RemoveKeyCommand}"
                                    Content="❌ Remove Key"
                                    Style="{StaticResource DangerButton}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!--  Keys List  -->
                    <ListView
                        Grid.Row="1"
                        FontFamily="Consolas"
                        FontSize="13"
                        ItemsSource="{Binding TranslationKeys}"
                        SelectedItem="{Binding SelectedKey}" />

                    <!--  Sort Button  -->
                    <Button
                        Grid.Row="2"
                        Margin="0,12,0,0"
                        Command="{Binding SortKeysCommand}"
                        Content="🔤 Sort Keys"
                        Style="{StaticResource PrimaryButton}" />
                </Grid>
            </GroupBox>

            <GridSplitter Grid.Column="3" />

            <!--  Translation Editor  -->
            <GroupBox
                Grid.Column="4"
                Header="✏️ Translations"
                Style="{StaticResource CardGroupBox}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding CurrentTranslations}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,0,16"
                                    Padding="16"
                                    Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                                    BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <Border
                                            Grid.Row="0"
                                            Margin="0,0,0,12"
                                            Padding="8,4"
                                            Background="{StaticResource PrimaryBrush}"
                                            CornerRadius="4">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontSize="16"
                                                    Text="🌍 " />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    Foreground="White"
                                                    Text="{Binding LanguageCode}" />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    Foreground="White"
                                                    Text=" - " />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    Foreground="White"
                                                    Text="{Binding FileName}" />
                                            </StackPanel>
                                        </Border>

                                        <TextBox
                                            Grid.Row="1"
                                            MinHeight="80"
                                            Margin="0,0,0,12"
                                            AcceptsReturn="True"
                                            FontSize="14"
                                            Text="{Binding Translation, UpdateSourceTrigger=PropertyChanged}"
                                            TextWrapping="Wrap" />

                                        <Expander Grid.Row="2" Header="⚙️ Placeholders (JSON)">
                                            <TextBox
                                                MinHeight="100"
                                                Margin="0,8,0,0"
                                                AcceptsReturn="True"
                                                FontFamily="Consolas"
                                                FontSize="12"
                                                Text="{Binding PlaceholderJson, UpdateSourceTrigger=PropertyChanged}"
                                                TextWrapping="Wrap" />
                                        </Expander>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </GroupBox>
        </Grid>

        <!--  Status Bar  -->
        <StatusBar Grid.Row="2" Margin="0,8,0,0">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📁 " />
                    <TextBlock FontWeight="SemiBold" Text="{Binding FlutterProjectPath, StringFormat='Flutter Project: {0}'}" />
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔑 " />
                    <TextBlock FontWeight="SemiBold" Text="{Binding TranslationKeys.Count, StringFormat='Keys: {0}'}" />
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📄 " />
                    <TextBlock FontWeight="SemiBold" Text="{Binding ArbFiles.Count, StringFormat='Files: {0}'}" />
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>